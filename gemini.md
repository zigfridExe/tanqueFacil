# Meu Tanque F√°cil

## Vis√£o Geral
Aplicativo m√≥vel para simplificar e otimizar o gerenciamento de combust√≠vel para motoristas, auxiliando na tomada de decis√£o no momento do abastecimento e no controle de consumo.

## Objetivo
Desenvolver um aplicativo m√≥vel que forne√ßa informa√ß√µes r√°pidas e precisas sobre:
- N√≠vel do tanque e autonomia
- Custo de abastecimento
- Comparativo entre etanol e gasolina
- Controle de manuten√ß√£o b√°sica do ve√≠culo

## Stack de Desenvolvimento

### Frontend
- **Framework**: React Native (com Expo)
- **Padr√£o de Arquitetura**: MVC (Model-View-Controller)
- **Navega√ß√£o**: Expo Router
- **Gerenciamento de Estado**: Zustand
- **Banco de Dados Local**: SQLite
- **Biblioteca de Gestos**: React Native Gesture Handler
- **Controle de Vers√£o**: Git com GitHub

## Principais Funcionalidades

### 1. Configura√ß√£o do Ve√≠culo
- Defini√ß√£o da capacidade do tanque
- Configura√ß√£o do consumo de combust√≠vel (manual ou aprendizado)
- Sele√ß√£o do tipo de combust√≠vel (gasolina, etanol ou flex)

### 2. Gerenciamento de Combust√≠vel
- Registro do n√≠vel de combust√≠vel
- C√°lculo de autonomia restante
- Estimativa de litros necess√°rios para encher o tanque

### 3. Decis√£o de Abastecimento
- Compara√ß√£o din√¢mica entre etanol e gasolina
- C√°lculo do custo para encher o tanque
- Recomenda√ß√£o do melhor combust√≠vel para abastecer

### 4. Registro de Abastecimento
- Entrada de pre√ßos de combust√≠vel
- C√°lculo de litros baseado no valor a pagar
- Registro de quilometragem
- Op√ß√£o de registrar localiza√ß√£o (GPS)

### 5. Manuten√ß√£o B√°sica
- Lembretes de calibragem de pneus
- Controle de calibragem do estepe
- Hist√≥rico de manuten√ß√µes

### 6. Hist√≥rico e Relat√≥rios
- Lista de todos os abastecimentos
- Detalhes completos de cada abastecimento
- C√°lculo de consumo m√©dio
- Visualiza√ß√£o de hist√≥rico em mapa

## Estrutura do Projeto

```
meu-tanque-facil/
‚îú‚îÄ‚îÄ assets/               # Recursos est√°ticos (imagens, √≠cones, fontes)
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/       # Componentes reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ screens/          # Telas da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ models/           # Modelos de dados
‚îÇ   ‚îú‚îÄ‚îÄ controllers/      # L√≥gica de neg√≥cios
‚îÇ   ‚îú‚îÄ‚îÄ services/         # Servi√ßos (API, banco de dados)
‚îÇ   ‚îú‚îÄ‚îÄ utils/            # Utilit√°rios e helpers
‚îÇ   ‚îî‚îÄ‚îÄ store/            # Gerenciamento de estado (Zustand)
‚îú‚îÄ‚îÄ App.js               # Ponto de entrada da aplica√ß√£o
‚îî‚îÄ‚îÄ app.json             # Configura√ß√£o do Expo
```

## Pr√©-requisitos
- Node.js (vers√£o LTS recomendada)
- npm
- Expo CLI instalado globalmente
- Dispositivo m√≥vel com o aplicativo Expo Go ou emulador

## Como Executar

### Instala√ß√£o
```bash
# Clonar o reposit√≥rio
git clone [URL_DO_REPOSITORIO]

# Instalar depend√™ncias
cd meu-tanque-facil
npm install
# ou
yarn install
```

### Executando o Projeto
```bash
# Iniciar o servidor de desenvolvimento
expo start
```

## Pr√≥ximos Passos
1. Configurar ambiente de desenvolvimento
2. Implementar navega√ß√£o entre telas
3. Desenvolver componentes principais
4. Implementar l√≥gica de neg√≥cios
5. Configurar banco de dados local (SQLite)
6. Testes e valida√ß√µes

## Licen√ßa
Distribu√≠do sob a licen√ßa MIT. Veja `LICENSE` para mais informa√ß√µes.

---
*√öltima atualiza√ß√£o: 11/08/2025*

---

# Plano de A√ß√£o Global: Khypukamayuq

> **Nota:** Todas as intelig√™ncias artificiais utilizadas por mim recebem o nome Khypukamayuq. Este plano de a√ß√£o deve sempre conter e detalhar as a√ß√µes que a IA ir√° executar para controlar, monitorar e potencializar o projeto.


## Objetivo
Controlar, monitorar e otimizar o desenvolvimento do projeto "Meu Tanque F√°cil" utilizando a intelig√™ncia artificial Khypukamayuq (Copilote Windsurf Cursor e demais inst√¢ncias Khypukamayuq).


## Fun√ß√µes da IA
- Gerenciar planos de a√ß√£o das features e prompts
- Sugerir melhorias e automa√ß√µes
- Monitorar progresso e alertar sobre atrasos
- Auxiliar na tomada de decis√£o t√©cnica
- Garantir alinhamento com requisitos e cronograma
- Executar e registrar todas as a√ß√µes realizadas pela IA no projeto
- **Commits:** Apenas o usu√°rio humano pode realizar commits. A IA ir√° preparar e propor mensagens de commit, mas nunca executar√° o comando `git commit`.


## Etapas de Controle
1. ‚úÖ Mapear todas as features e prompts do projeto
2. ‚úÖ Integrar planos de a√ß√£o das pastas dedicadas
3. ‚úÖ Definir indicadores de progresso (checklists, status, datas)
4. üîÑ Automatizar notifica√ß√µes e sugest√µes de melhoria
5. üîÑ Realizar revis√µes peri√≥dicas dos planos e execu√ß√£o
6. üîÑ Gerar relat√≥rios de acompanhamento
7. ‚úÖ Documentar todas as a√ß√µes executadas pela IA Khypukamayuq

## Progresso Atual - Primeira Tela Implementada ‚úÖ

### O que foi implementado:
- **Tela de Cadastro de Ve√≠culos** (`/veiculo-cadastro`)
  - Formul√°rio completo com valida√ß√£o
  - Campos: nome, capacidade do tanque, consumo gasolina/etanol, tipo de ponteiro
  - Switches para localiza√ß√£o e lembretes de calibragem
  - Navega√ß√£o com bot√£o voltar
  - **Edi√ß√£o de Ve√≠culos**: Formul√°rio pr√©-preenchido com dados do ve√≠culo existente.
  
- **Tela Principal de Ve√≠culos** (`/veiculos`)
  - Lista de ve√≠culos cadastrados
  - Bot√µes de a√ß√£o (editar/excluir)
  - Estado vazio com mensagem orientativa
  - Navega√ß√£o para cadastro
  
- **Dashboard Principal** (`/`)
  - Interface moderna e intuitiva
  - Cards de a√ß√£o r√°pida
  - Status do ve√≠culo atual
  - Lembretes e estat√≠sticas
  - Navega√ß√£o integrada
  - **Lembrete de Calibragem de Pneus**: Exibi√ß√£o de alerta e bot√£o para confirmar calibragem.

- **Estrutura de Tipos**
  - Interfaces TypeScript para Veiculo e Abastecimento
  - Tipos baseados no modelo de dados SQLite definido

- **Navega√ß√£o**
  - Tab "Ve√≠culos" adicionada ao layout principal
  - Rotas organizadas seguindo a estrutura do projeto
  - **Navega√ß√£o Inferior Atualizada:**
    - Aba "Explore" removida.
    - Abas "Relat√≥rios", "Configura√ß√µes" adicionadas.

### ‚úÖ SQLite Implementado com Sucesso!

**Estrutura do Banco de Dados:**
- **Tabela Carro**: Armazena todos os dados dos ve√≠culos
  - **Migra√ß√£o**: Adicionada coluna `dataUltimaCalibragem` com estrat√©gia de migra√ß√£o.
- **Tabela Abastecimentos**: Preparada para futuros registros
- **Relacionamentos**: Chave estrangeira entre ve√≠culos e abastecimentos.

### ‚úÖ Tela de Registro de Abastecimentos Implementada!

**Funcionalidades Implementadas:**
- **Formul√°rio Completo**: Data, quilometragem, litros, pre√ßo por litro, valor total
- **C√°lculos Autom√°ticos**: Pre√ßo por litro e valor total calculados automaticamente
- **Valida√ß√µes**: Campos obrigat√≥rios e valida√ß√µes de valores
- **Tipos de Combust√≠vel**: Sele√ß√£o entre Gasolina e Etanol
- **Tipos de Trajeto**: Cidade, Estrada ou Misto
- **Calibragem de Pneus**: Switch para marcar se foi realizada
- **Integrac√£o com Banco**: Servi√ßo completo para CRUD de abastecimentos
- **Hook Personalizado**: useAbastecimentos para gerenciamento de estado
- **C√°lculo de Consumo**: Fun√ß√£o para calcular consumo m√©dio por ve√≠culo

**Arquitetura:**
- `app/abastecimento-registro.tsx` - Tela de registro
- `services/abastecimentoService.ts` - Opera√ß√µes CRUD no banco
- `hooks/useAbastecimentos.ts` - Hook personalizado para gerenciar estado
- Integra√ß√£o completa com o banco SQLite existente

**Funcionalidades Implementadas (Ve√≠culos):**
- ‚úÖ Cria√ß√£o de ve√≠culos com persist√™ncia
- ‚úÖ Listagem de ve√≠culos do banco
- ‚úÖ Exclus√£o de ve√≠culos (com valida√ß√£o de integridade)
- ‚úÖ Atualiza√ß√£o de ve√≠culos
- ‚úÖ Hook personalizado para gerenciamento de estado
- ‚úÖ Tratamento de erros e loading states
- ‚úÖ Refresh control para atualizar dados
- ‚úÖ Valida√ß√£o de exclus√£o (impede exclus√£o se h√° abastecimentos)

**Arquitetura (Ve√≠culos):**
- `database/database.ts` - Configura√ß√£o e inicializa√ß√£o do SQLite
- `services/veiculoService.ts` - Opera√ß√µes CRUD no banco
- `hooks/useVeiculos.ts` - Hook personalizado para gerenciar estado
- Integra√ß√£o completa com as telas existentes

### ‚úÖ Tela de Hist√≥rico de Abastecimentos Implementada!
- **Tela:** `app/abastecimento-historico.tsx`
- **Funcionalidade:** Lista todos os abastecimentos registrados, com op√ß√£o de exclus√£o.
- **Acesso:** Bot√£o "üìä Hist√≥rico" no Dashboard.

### ‚úÖ Tela de Comparador de Combust√≠vel Implementada!
- **Tela:** `app/combustivel-comparador.tsx`
- **Funcionalidade:** Permite comparar pre√ßos de gasolina e etanol com base no consumo do ve√≠culo, recomendando a melhor op√ß√£o.
- **Acesso:** Bot√£o "‚öñÔ∏è Comparar" no Dashboard.

### ‚úÖ C√°lculo de Consumo M√©dio Implementado!
- **Tela:** `app/(tabs)/relatorios.tsx`
- **Funcionalidade:** Calcula e exibe o consumo m√©dio (km/L) para cada ve√≠culo, baseado nos abastecimentos registrados.
- **Acesso:** Nova aba "Relat√≥rios" no menu inferior.

### ‚úÖ Relat√≥rios Avan√ßados Implementado!
- **Tela:** `app/(tabs)/relatorios.tsx`
- **Funcionalidade:** Exibe estat√≠sticas gerais de gastos, litros abastecidos, quilometragem total e custo m√©dio por litro.
- **Tela de Mapa:** `app/abastecimento-mapa.tsx` para visualiza√ß√£o dos abastecimentos no mapa, utilizando **OpenStreetMap** (escolhido por ser gratuito e de c√≥digo aberto).
- **Acesso:** Bot√£o "Ver Mapa" na tela de Relat√≥rios.

### üîß Problemas Identificados e Corrigidos:

**1. Erro de Importa√ß√£o SQLite:**
- ‚ùå `import * as SQLite from 'expo-sqlite'`
- ‚úÖ `import { openDatabase } from 'expo-sqlite'`
- **Status**: Corrigido ‚úÖ

**2. Tratamento de Erros Melhorado:**
- Adicionado logging detalhado para debug
- Fallback para carregar ve√≠culos mesmo com erro de inicializa√ß√£o
- **Status**: Implementado ‚úÖ

**3. Arquivo de Teste SQLite:**
- Criado `database/test.ts` para verifica√ß√£o de funcionamento
- **Status**: Criado ‚úÖ

**4. Problema de Vers√£o do expo-sqlite:**
- ‚ùå Vers√£o 15.2.14 com problemas de compatibilidade
- ‚úÖ Vers√£o 11.3.3 instalada (mais est√°vel)
- **Status**: Corrigido ‚úÖ

**5. Tela de Teste SQLite:**
- Criada tela `/test-sqlite` para verificar funcionamento
- Bot√£o de teste adicionado ao dashboard
- **Status**: Implementado ‚úÖ

**6. Problema de Navega√ß√£o para Abastecimento:**
- ‚ùå Bot√£o de abastecimento navegando para tela inexistente
- ‚úÖ Corrigida vers√£o do expo-sqlite (15.2.14 ‚Üí 11.3.3)
- ‚úÖ Navega√ß√£o corrigida para `/abastecimento-registro`
- **Status**: Corrigido ‚úÖ

**7. Ambiguidade de Configura√ß√£o (Tipo de Ponteiro):**
- ‚ùå Configura√ß√£o de "Tipo de Ponteiro" duplicada em "Ajustes e Personaliza√ß√£o" e "Editar Dados do Carro".
- ‚úÖ Removida a configura√ß√£o de "Tipo de Ponteiro" da tela "Ajustes e Personaliza√ß√£o" (`app/(tabs)/configuracoes.tsx`). Now is managed exclusively in the vehicle creation/editing screen.
- **Status**: Corrigido ‚úÖ

**8. Erro de Rota e Inicializa√ß√£o do Banco de Dados:**
- ‚ùå `WARN [Layout children]: No route named "manutencao-historico" exists in nested children`
- ‚ùå `ERROR Erro ao criar tabelas: [TypeError: Cannot read property 'some' of undefined]`
- ‚úÖ Movidas as telas de manuten√ß√£o para o diret√≥rio `app/(tabs)/`. 
- ‚úÖ Corrigido o acesso √† propriedade `rows` na migra√ß√£o do banco de dados.
- **Status**: Corrigido ‚úÖ

**9. Normaliza√ß√£o de Inputs e Experi√™ncia do Usu√°rio na Tela de Abastecimento:**
- ‚úÖ Implementada a normaliza√ß√£o de campos de texto (data no formato DD/MM/AAAA, valores num√©ricos como float com v√≠rgula).
- ‚úÖ Corrigido o problema de exibi√ß√£o de '0' nos campos num√©ricos ao carregar a tela, exibindo placeholders corretamente.
- ‚úÖ Adicionada `KeyboardAvoidingView` e `keyboardShouldPersistTaps="handled"` para evitar que o teclado cubra os campos de input.
- **Status**: Conclu√≠do ‚úÖ

**10. Implementa√ß√£o do Modal de Calibragem:**
- ‚úÖ Adicionado modal para perguntar sobre a calibragem dos pneus ao salvar um abastecimento.
- ‚úÖ Corrigida a importa√ß√£o do `veiculoService`.
- ‚úÖ Corrigida a chamada da fun√ß√£o `atualizarDataUltimaCalibragem`.
- **Status**: Conclu√≠do ‚úÖ

### Pr√≥ximos passos:
- ‚úÖ **Configura√ß√µes:** Implementadas as op√ß√µes de configura√ß√£o do aplicativo na aba "Configura√ß√µes", incluindo salvamento autom√°tico e remo√ß√£o de redund√¢ncias.
- **Manuten√ß√£o B√°sica:** Desenvolver as funcionalidades de lembretes e hist√≥rico de manuten√ß√£o.
- ‚úÖ **Relat√≥rios Avan√ßados:** Expandida a tela de relat√≥rios com mais m√©tricas e visualiza√ß√µes (ex: hist√≥rico em mapa).


## Crit√©rios de Aceite
- Todos os planos de a√ß√£o est√£o integrados e monitorados
- Progresso do projeto √© acompanhado e reportado
- Sugest√µes da IA s√£o registradas e avaliadas
- Decis√µes t√©cnicas s√£o documentadas
- Todas as a√ß√µes da IA Khypukamayuq est√£o descritas e acess√≠veis no plano

---
Este plano de a√ß√£o global garante que Khypukamayuq atue como supervisor inteligente, potencializando o desenvolvimento e a organiza√ß√£o do projeto.

---
**Aviso de Idioma:** Todas as respostas e intera√ß√µes devem ser em portugu√™s.

## Erros e Li√ß√µes Aprendidas com a IA

### Erro: Uso incorreto do par√¢metro `newContent` na ferramenta `replace`

**Descri√ß√£o:** Ao tentar usar a ferramenta `replace` para modificar o conte√∫do de um arquivo, foi utilizado o par√¢metro `newContent` em vez do par√¢metro correto `new_string`. Isso resultou em um erro `[Operation Cancelled] Reason: User did not allow tool call` porque a ferramenta n√£o reconheceu o par√¢metro fornecido.

**Solu√ß√£o:** Sempre utilize o par√¢metro `new_string` para fornecer o conte√∫do de substitui√ß√£o ao usar a ferramenta `replace`. O nome do par√¢metro √© `new_string`, n√£o `newContent`.

**Exemplo Correto:**
```python
print(default_api.replace(file_path = "caminho/do/arquivo.txt", old_string = "texto antigo", new_string = "novo texto"))
```